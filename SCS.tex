\documentclass[11pt,a4paper]{ivoa}
\input tthdefs

\usepackage{todonotes}

\usepackage{listings}
\lstloadlanguages{XML,sh}
\lstset{flexiblecolumns=true,tagstyle=\ttfamily,
showstringspaces=False}

\usepackage{multirow}

\title{Simple Cone Search}

\ivoagroup{Data Access Layer}

\author[http://www.ivoa.net/twiki/bin/view/IVOA/RayPlante]{Raymond Plante}
\author[http://www.ivoa.net/twiki/bin/view/IVOA/MarcoMolinaro]{Marco Molinaro}
\author[http://www.ivoa.net/twiki/bin/view/IVOA/MarkusDemleitner]{Markus Demleitner}
\author[http://www.ivoa.net/twiki/bin/view/IVOA/BobHanisch]{Robert Hanisch}
\author[http://www.ivoa.net/twiki/bin/view/IVOA/AlexSzalay]{Alex Szalay}
\author[http://www.ivoa.net/twiki/bin/view/IVOA/RoyWilliams]{Roy Williams}

\editor{Ray Plante, Marco Molinaro}

\previousversion[http://www.ivoa.net/Documents/REC/DAL/ConeSearch-20080222.html]{REC 1.03}
\previousversion[http://www.ivoa.net/Documents/PR/DAL/ConeSearch-20070914.html]{PR 2007-09-14}
\previousversion[http://www.ivoa.net/Documents/PR/DAL/ConeSearch-20070628.html]{PR 2007-06-28}
\previousversion[http://www.ivoa.net/Documents/PR/DAL/ConeSearch-20060908.html]{PR 2006-09-08}
       

\begin{document}
\begin{abstract}
This specification defines a simple query protocol, named Simple Cone Search (SCS or simply cone search hereafter), for retrieving records from a catalog of astronomical sources. The query describes a sky position and an angular distance, defining a cone on the sky. The response returns a list of astronomical sources from the catalog whose positions lie within the cone, formatted as a VOTable. This version aims essentially at aligning this specification with the Data Access Layer (DAL) landscape at the time of writing.
\end{abstract}


\section*{Acknowledgments}
This document was originally published as a document of the US National Virtual Observatory (NVO) \todo{check if the document or a link is still available} and then transcripted into an IVOA standards document format to became an IVOA recommendation. The changes made in this transcription and in the process of producing the first recommandation are reported in Appendix \ref{app:changes}.

The Simple Cone Search (SCS) version 1.03 document has been developed with support from the National Science Foundation's Information Technology Research Program under Cooperative Agreement AST0122449 with The Johns Hopkins University.

The SCS-1.1 revision has been developed under the ASTERICS project, supported by the European Commission Framework Programme Horizon 2020 Research and Innovation action, grant agreement n. 653477.

Work of the original authors of the Cone Search specification as well as the numerous data providers who have implemented and continue to support this protocol is kindly ackonwledged.

\section*{Conformance-related definitions}

The words ``MUST'', ``SHALL'', ``SHOULD'', ``MAY'', ``RECOMMENDED'', and
``OPTIONAL'' (in upper or lower case) used in this document are to be
interpreted as described in IETF standard RFC2119 \citep{std:RFC2119}.

The \emph{Virtual Observatory (VO)} is a
general term for a collection of federated resources that can be used
to conduct astronomical research, education, and outreach.
The \href{http://www.ivoa.net}{International
Virtual Observatory Alliance (IVOA)} is a global
collaboration of separately funded projects to develop standards and
infrastructure that enable VO applications.


\section{Introduction}

This specification describes how a provider of an astronomical source catalog can publish that catalog to the Virtual Observatory in such a way that a simple cone search can be done. The data remains in the control of the data provider, served through a web server to the world, but the query profile and response profile are carefully controlled, as described below. It is intended that setting up this web service be simple enough that data providers will not have to spend too much time on it (their funding to support such services is typically small). At the same time, the service implementation and the data it provides can serve as a basis for more sophisticated tools.

This specification does not specify how cone search services are implemented, or how the data are stored or manipulated. The concern of this specification is how the data are exposed to the world through well-defined requests and responses.

This specification assumes that the data provider has already selected a catalog of astronomical sources. This catalog can be presented as a single table; it is expected that the table contains several columns.

\subsection{Role within the VO Architecture}

\begin{figure}
\centering

% Get the architecture diagram from the TCG chair
% http://wiki.ivoa.net/twiki/bin/view/IVOA/IvoaTCG
% If they give you a PDF, for now dumb it down to a png by
% convert -antialias -density 72x72 archdiag.pdf archdiag.png
% Oh -- Notes don't need this; you'd have to remove archdiag.png
% from FIGURES in the Makefile, too.

\includegraphics[width=0.9\textwidth]{archdiag.png}
\caption{Architecture diagram for SCS - TODO}
\label{fig:archdiag}
\end{figure}

Fig.~\ref{fig:archdiag} shows the role this document plays within the
IVOA architecture \citep{note:VOARCH}.

\section{Resource Interface}
\label{sec:resif}

A SCS service for accessing catalogue resources is implemented as a synchronous resource (as compliant as possible to the DALI specification, \citet{std:DALI}) that must meet the following requirements:
\begin{itemize}
	\item the resource \textbf{must} respond to requests submitted using an HTTP GET query string, and may respond to HTTP POST query actions, as described in Sec.~\ref{sec:basepar};
	\item the response must be a valid VOTable document, providing a table containing the sources of the catalogue whose positions are within the cone described in the query request (see Sec.~\ref{sec:response}); or
	\item must return a stubbed VOTable in case of error, as described in Sec.~\ref{sec:error}.
\end{itemize}

\subsection{Interface base and parameters}
\label{sec:basepar}
The SCS service endpoint is represented by a \xmlel{base\_url} formed by a \xmlel{<base\_path>} and an optional \xmlel{<base\_query>} of the form
\begin{bigdescription}
	\item[SCS base URL syntax] \texttt{http://<server>/<base\_path>?<base\_query>}
\end{bigdescription}
where \xmlel{<base\_path>} is a URI-compliant component indicating the local location path and the \xmlel{<base\_query>} may optionally be formed by locally supported query parameters; these latter are not recognized parts of the SCS protocol and thus are treated opaquely by clients of the service as part of the \xmlel{base\_url}.\\
Note that when it contains extra GET arguments, the \xmlel{base\_url} ends in an ampersand, \&; if there are no extra arguments, then it ends in a question mark, ?.\\
		\begin{bigdescription}
		\item[Examples] \texttt{http://mycone.org/cgi-bin/VOsearch?}\\
		\texttt{http://adil.ncsa.uiuc.edu/vocone?resolv\&issurvey=T\&}
		\end{bigdescription}
Every query to a given cone search service uses the same base URL.

Constraints to filter the catalogue are expressed as a list of ampersand-delimited GET arguments of the form: \xmlel{<name>=<value>} where \xmlel{<name>} is a parameter name specified by this specification and \xmlel{<value>} is its value. The constraints represent the query parameters which can vary for each successive query. The order of the name-parameter pairs is not significant.

The \xmlel{base\_url} and constraint list are concatenated to form the query.

In the case the SCS service accepts HTTP POST action for query, the \xmlel{value=param} constraints must be passed on to the service as data in the request body, with \texttt{application/x-www-form-urlencoded} encoding type. Whether the \xmlel{<base\_query>} parameters are accepted as POST parameters or not, is up to the service provider.\todo{There's currently no way to alert clients on SCS service POST capability. This poses a question on best practices here. Maybe allowing 1.03 baseURL but moving already towards a 1.1 PathParam only baseURL?} Mixed GET/POST queries are possible.

The set of query constraints a cone search needs to understand \textbf{must} include the \textbf{RA}, \textbf{DEC}, \textbf{SR} parameters, \textbf{should} include the \textbf{MAXREC} and \textbf{RESPONSEFORMAT} ones and \textbf{may} include the \textbf{VERB} one, all of which are to be interpreted with the following stated meaning and the DALI recommendations about parameters.

\subsubsection{RA}
\textbf{RA} represents a right-ascension in the ICRS coordinate system for the position of the center of the cone to search, given in decimal degrees. It is a single valued parameter and \textbf{must} be present in the query.

\subsubsection{DEC}
\textbf{DEC} represents a declination in the ICRS coordinate system for the position of the center of the cone to search, given in decimal degrees. It is a single value parameter and \textbf{must} be present in the query.

\subsubsection{SR}
\textbf{SR} represents the radius of the cone to search, given in decimal degrees. It is a single valued parameter and \textbf{must} be present in the query. If set to zero (SR=0) it should have the same effect as setting MAXREC=0, i.e. a service metadata request as prescribed by DALI\footnote{SR=0 is kept in this version of this specification for back compatibility. It is suggested to prefer the usage of MAXREC to enable metadata discovery}.

\subsubsection{MAXREC}
As defined by DALI a cone search \textbf{should} accept the \textbf{MAXREC} parameter to let the client limit the number of records returned or require a service metadata response (see above).  Its usage is encouraged and preferred to the SR=0 solution for metadata discovery.

\subsubsection{RESPONSEFORMAT}
\label{subsubsec:responseformat}
An SCS service \textbf{must} provide responses in VOTable \citep{std:VOTABLE} format, compliant with respect to what will be detailed in Sec.~\ref{sec:response}, but \textbf{should} also support the DALI \textbf{RESPONSEFORMAT} parameter. Allowed media types for VOTable response \textbf{should} be the \xmlel{application/x-votable+xml} or \xmlel{text/xml} as specified by DALI but \xmlel{text/xml;content=x-votable} may be considered legal for backward compatibility reasons.

\subsubsection{VERB}
The query \textbf{may} contain the optional single valued parameter, \textbf{VERB}, whose value is an integer (either 1, 2, or 3) indicating verbosity which determines how many columns are to be returned in the resulting table. If the service supports the parameter, then when the value is 1, the response should include the bare minimum of columns that the provider considers useful in describing the returned objects (while still remaining compliant with this standard; see section \ref{sec:response} below). When the value is 3, the service should return all of the columns that are available for describing the objects. A value of 2 is intended for requesting a medium number of columns between the minimum and maximum (inclusive) that are considered by the provider to most typically useful to the user. When the VERB parameter is not provided, the server should respond as if VERB=2. If the VERB parameter is not supported by the service, the service should ignore the parameter and should always return the same columns for every request.

There may be other parameters in the query, but this document does not specify their meaning or usage. If a query includes an optional parameter, either one specified by this document or not, that is not supported by the service implementation, the service must ignore that parameter.

A query following this syntax represents a request for information on sources located within the specified cone on the sky.

\subsection{Query examples}
\begin{bigdescription}
\item[Minimal SCS query] \texttt{http://my.cone/search?RA=10.68\&DEC=41.26\&SR=0.01}
\item[Service Metadata query] \texttt{http://my.cone/search?cat=A1\&RA=0\&DEC=0\&SR=0\&MAXREC=0}
\item[Limit number of records in response] \texttt{http://my.cone/search?RA=10.68\&DEC=41.26\&SR=1\&MAXREC=100}
\item[Ask for the minimal set of response fields] \texttt{http://my.cone/search?RA=10.68\&DEC=41.26\&SR=0.01\&VERB=1}
\end{bigdescription}

TODO\todo{add POST example?}

\section{Successful Response}
\label{sec:response}
A successful query \textbf{must} result in an HTTP response with status code 200 (OK) and a content that, by default, \textbf{must be} VOTable format, that represents a table of astronomical sources whose positions are within the cone (see Appendix \ref{app:responsesample} for an example).  

There may also be other sources outside the cone -- the service implementor may decide on the exact search criterion used internally to the service to select the sources.

The response format may be other than VOTable when requested using the RESPONSEFORMAT query parameter described in Sec.~\ref{subsubsec:responseformat}. Mime-type of the response will vary accordingly to the output format, again as prescribed by DALI and reported in Sec.~\ref{subsubsec:responseformat}.

The VOTable \textbf{MUST} comply with the following conditions.

There \textbf{must} be a single \xmlel{RESOURCE} in the VOTable, and that contains a single \xmlel{TABLE}.

The \xmlel{TABLE} \textbf{must} have \xmlel{FIELD}s where the following UCD values have been set. There \textbf{must} only be one \xmlel{FIELD} with each of these UCDs:
\begin{itemize}
	\item Exactly one \xmlel{FIELD} \textbf{must} have \xmlel{ucd="ID\_MAIN"}, with an array character type (fixed or variable length), representing an ID string for that record of the table. This identifier \textbf{may not} be repeated in the table, and it could be used to retrieve that same record again from that same table.
	\item Exactly one \xmlel{FIELD} \textbf{must} have \xmlel{ucd="POS\_EQ\_RA\_MAIN"}, with type double, representing the right-ascension of the source in the ICRS coordinate system.
	\item Exactly one \xmlel{FIELD} \textbf{must} have \xmlel{ucd="POS\_EQ\_DEC\_MAIN"}, with type double, representing the declination of the source in the ICRS coordinate system.
\end{itemize}
The VOTable may include an expression of the uncertainty of the positions given in the above mentioned fields to be interpreted either as a positional error of the source positions, or an angular size if the sources are resolved. If this uncertainty is not provided, it should be taken to be zero; otherwise, it may be set for all table entries with a \xmlel{PARAM} in the \xmlel{RESOURCE} which has a UCD that is set to OBS\_ANG-SIZE and has a value which is the angle in decimal degrees. Alternatively, a different value for each row in the table can be given via a \xmlel{FIELD} in the table having a UCD set to OBS\_ANG-SIZE.
There may be other \xmlel{FIELD}s in the table. Their specification \textbf{should} include description, data-type, and UCD.

\section{Error Response}
\label{sec:error}
The service \textbf{must} respond with a stubbed version of the VOTable in the case of error. This must happen if the three required parameters (RA, DEC, SR) are not all present, or if their values cannot be parsed to floating-point numbers, or if the numbers are out of range (DEC=91.0, for example). The service may also make an error return if the search radius (give by the SR parameter) is larger than the MaxSR parameter of the Resource Profile (see Section \ref{sec:regext}).

In the case of error, the service \textbf{must} respond with a VOTable that contains a single \xmlel{PARAM} element or a single \xmlel{INFO} element with \xmlel{name="Error"}, where the corresponding value attribute should contain some explanation of the nature of the error. If an \xmlel{INFO} element is used, it must appear as a direct child of one of the following elements:
\begin{itemize}
	\item the root \xmlel{VOTABLE} element (which is preferred by this document), or
	\item the \xmlel{RESOURCE} element
\end{itemize}

If a \xmlel{PARAM} element is used, it must appear as a direct child of one of following elements:
\begin{itemize}
	\item the \xmlel{RESOURCE element}, or
	\item a \xmlel{DEFINITION} element below the root \xmlel{VOTABLE} element (which is discouraged by this document).
\end{itemize}
\begin{bigdescription}
	\item[Editor's Note] It was recognized that this requirement, as it was described in the original NVO specification, is ambiguous about both the element to use for the ERROR message and its location in the document. The VOTable standard allows PARAM and INFO elements to appear in various places within the document. Since several of the different methods have been used in practice by Cone Search service implementations, no attempt is made in this version to correct this ambiguity. All of the above-mentioned locations should be considered legal, and Cone Search service clients should be prepared to look in all of them for an ERROR message. The use of PARAM as a child of DEFINITIONS is discouraged as the DEFINITIONS element was deprecated in VOTable v1.1.
\end{bigdescription}
\begin{bigdescription}
	\item[Example Error Responses] Error INFO as child of VOTABLE (preferred)\\
	\begin{lstlisting}[language=XML,basicstyle=\footnotesize]
<?xml version="1.0"?>
<!DOCTYPE VOTABLE SYSTEM "http://us-vo.org/xml/VOTable.dtd">
<VOTABLE version="1.0">
  <DESCRIPTION>MAST Simple Cone Search Service</DESCRIPTION>
  <INFO ID="Error" name="Error" value="Error in input RA value: as3f"/>
</VOTABLE>
	\end{lstlisting}
	Error PARAM as child of RESOURCE (allowed)
	\begin{lstlisting}[language=XML,basicstyle=\footnotesize]
<?xml version="1.0"?>
<!DOCTYPE VOTABLE SYSTEM "http://us-vo.org/xml/VOTable.dtd">
<VOTABLE version="1.0">
  <DESCRIPTION>
     HEASARC Browse data service
     Please send inquiries to mailto:request@athena.gsfc.nasa.gov
  </DESCRIPTION>
  <RESOURCE ID="error_resource">
   <PARAM ID="Error" name="Error" datatype="char" arraysize="*"
          value="Invalid data type: text/html"/>
 </RESOURCE>
</VOTABLE>
	\end{lstlisting}
\end{bigdescription}

Other conditions may NOT be considered erroneous, for example if a query cone is in the Southern hemisphere and the catalog coverage is in the Northern hemisphere. This type of query is different from an error return; it should return a VOTable as described above, with metadata, but no data records. In particular, a zero value of Search Radius should not return an error condition. This is because an application may be more interested in the metadata than the data, and send a fixed query (for example RA=0\&DEC=90\&SR=0) simply to discover the fields delivered by the service.

\section{The Resource Profile}
\label{sec:regext}
A Cone Search service MUST be described with a Resource Profile that includes the following information. The Profile is composed of named metadata listed below. The format used to encode the profile should be compliant with the publishing standards of the IVOA throughout the time the service is supported by the data provider. The metadata names and values used in the profile encoding should match those given below as closely as possible; where they do not match exactly, they should be consistent with the IVOA metadata conventions in place at any given time and the mapping of names and values actually used and those given below should be well documented.
\begin{bigdescription}
\item[Editor's Note] The original NVO specification pre-dates the IVOA standard for resource metadata [RM], and so, obviously, some inconsistencies with that standard exist. To deal with this, the wording of this section has been altered to allow profiles to be constructed according to the latest practices in the IVOA. Appendix B outlines the mapping of the metadata listed below to that in the RM as well as the XML Schema used to render the metadata within a Registry.
\end{bigdescription}
Several of the metadata listed below can have values that are hierarchical; this hierarchy should be represented in a manner most appropriate to the format used. When the format does not provide any such mechanism, it is recommended that the value be represented as a strings delimited by dots with the root domain of the value appearing first.

The resource profile consists of the following metadata with the stated definitions:
\begin{itemize}
	\item[\textbf{ResponsibleParty}] The data provider's name and email.
	\item[\textbf{ServiceName}] The name of the catalog served by the service, for example "IRSA.2MASS.ExtendedSources".
	\item[\textbf{Description}] A couple of paragraphs of text that describe the nature of the catalog and its wider context.
	\item[\textbf{Instrument}] The instrument that made the observations, for example STScI.HST.WFPC2.
	\item[\textbf{Waveband}] The waveband of the observations, with ONE selected from this list: radio, millimeter, infrared, optical, ultraviolet, xray, gammaray.
	\item[\textbf{Epoch}] The epoch of the observations, as a free-form string.
	\item[\textbf{Coverage}] The coverage on the sky, as a free-form string.
	\item[\textbf{MaxSR}] The largest search radius, given in decimal degrees, that will be accepted by the service without returning an error condition. A value of 180.0 indicates that there is no restriction.
	\item[\textbf{MaxRecords}] The largest number of records that the service will return.
	\item[\textbf{Verbosity}] True or false, depending on whether the service supports the VERB keyword in the request.
	\item[\textbf{BaseURL}] The base URL for the service as described in Section \ref{sec:resif}.
\end{itemize}
The service will be considered published to the VO if the profile has been added to an IVOA Registry according to the IVOA standards and conventions at the time the service is made available, TOGETHER with maintaining the web service that is described by the profile in compliant order.

\appendix
\section{Sample VOTable Response}
\label{app:responsesample}
This is a sample of a legal response to a Cone Search query.
\begin{lstlisting}[language=XML,basicstyle=\footnotesize]
<?xml version="1.0"?>
<!DOCTYPE VOTABLE SYSTEM "http://us-vo.org/xml/VOTable.dtd">
<VOTABLE version="1.0">
  <DEFINITIONS>
    <COOSYS system="eq_FK5" equinox="2000" />
  </DEFINITIONS>
  <RESOURCE ID="T9001">
     <DESCRIPTION>
       HEASARC Browse data service
       Please send inquiries to mailto:request@athena.gsfc.nasa.gov
    </DESCRIPTION>
    <PARAM ID="default_search_radius" ucd="OBS_ANG-SIZE" datatype="double" 
           value="0.0516666666666667" />
    <TABLE ID="heasarc_first_9001">
      <DESCRIPTION> Faint Images of the Radio Sky at Twenty cm Source Catalog (FIRST) </DESCRIPTION>
      <FIELD name="unique_id" datatype="char" arraysize="*"  ucd="ID_MAIN">
        <DESCRIPTION> Integer key </DESCRIPTION>
      </FIELD>
      <FIELD name="name" datatype="char" arraysize="*"  >
        <DESCRIPTION> FIRST Source Designation </DESCRIPTION>
      </FIELD>
      <FIELD name="ra" datatype="double" unit="degree" ucd="POS_EQ_RA_MAIN">
        <DESCRIPTION> Right Ascension </DESCRIPTION>
      </FIELD>
      <FIELD name="dec" datatype="double" unit="degree" ucd="POS_EQ_DEC_MAIN">
        <DESCRIPTION> Declination </DESCRIPTION>
      </FIELD>
      <FIELD name="flux_20_cm" datatype="double" unit="mJy" >
        <DESCRIPTION> Peak 1.4GHz Flux Density (mJy) </DESCRIPTION>
      </FIELD>
      <FIELD name="flux_20_cm_error" datatype="double" unit="mJy" >
        <DESCRIPTION> Estimated rms in at Source (mJy) </DESCRIPTION>
      </FIELD>
      <FIELD name="int_flux_20_cm" datatype="double" unit="mJy" >
        <DESCRIPTION> Integrated 1.4GHz Flux Density (mJy) </DESCRIPTION>
      </FIELD>
      <DATA>
        <TABLEDATA>
		<TR>
		  <TD>384559</TD><TD>FIRST J120002.6+595708</TD>
		  <TD>180.0110042</TD><TD>59.9523889</TD>
		  <TD>    1.11</TD><TD> 0.139</TD><TD>    1.14</TD>
		</TR>
		<TR>
		  <TD>385094</TD><TD>FIRST J120025.3+600103</TD>
		  <TD>180.1057250</TD><TD>60.0175556</TD>
		  <TD>    2.89</TD><TD> 0.142</TD><TD>    2.56</TD>
		</TR>
		<TR>
		  <TD>384928</TD><TD>FIRST J120018.1+600236</TD>
		  <TD>180.0755500</TD><TD>60.0434750</TD>
		  <TD>   19.38</TD><TD> 0.145</TD><TD>   19.23</TD>
		</TR>
		<TR>
		  <TD>384490</TD><TD>FIRST J115959.4+600403</TD>
		  <TD>179.9978875</TD><TD>60.0677083</TD>
		  <TD>    1.01</TD><TD> 0.147</TD><TD>    1.20</TD>
		</TR>
        </TABLEDATA>
      </DATA>
    </TABLE>
  </RESOURCE>
</VOTABLE>
\end{lstlisting}

\section{Current Practices for Representing Resource Profiles}

\subsection{Mapping for Resource Profile Metadata to the RM}
As mentioned in an Editor's Note in Section \ref{sec:regext}, the original NVO specification pre-dated the IVOA standard for resource metadata known as the RM \citep{STD:RM101}. This section indicates how the resource profile metadata defined in this specification maps to the metadata defined in the RM.
\begin{table}[th]
\begin{tabular}{p{0.4\textwidth}p{0.5\textwidth}}
\sptablerule
\textbf{Cone Search Metadatum} & \textbf{RM Metadatum}\\
\sptablerule
\textbf{ResponsibleParty} & Publisher, Contact.Email\\
\textbf{ServiceName} & Title\\
\textbf{Description} & Description\\
\textbf{Instrument} & Instrument\\
\textbf{Waveband} & Coverage.Spectral\\
\textbf{Epoch} & Coverage.Temporal.StartTime, Coverage.Temporal.StopTime\textsuperscript{1}\\
\textbf{Coverage} & Coverage.Spatial\\
\textbf{MaxSR} & Service.MaxSearchRadius\\
\textbf{MaxRecords} & Service.MaxReturnRecords\\
\textbf{Verbosity} & n/a\textsuperscript{2}\\
\textbf{BaseURL} & Service.BaseURL\\
\sptablerule
\caption{Metadata Mapping}
\label{table:b1meta}
\end{tabular}
\end{table}
Table notes:
\begin{enumerate}
	\item The notion of the epoch the observations is captured in the RM as the temporal coverage. The notion of the equinox of the observational positions is captured part of the RM's Coverage.Spatial.
	\item As this concept is not covered by the RM, it should be considered service-specific capability metadata.
\end{enumerate}

\subsection{VOResource (pre-v1.0) Schema Extension for Cone Search Services}
Just prior to the adoption of IVOA standard for registry interfaces, v1.0, resource descriptions were encoded using the VOResource XML Schema, v0.10 and its family of extension schemas. The extensions used to specifically describe Cone Search services were VODataService, v0.5 and ConeSearch, v0.3\todo{The references to RI, VOResource, VODataService and ConeSearch here, are all referring to xsd schemata currently obsoleted.}. See the embedded documentation in each of these schemas for the precise definitions and usage of the metadata encodable through them.

The following table enumerates the mapping of resource profile metadata defined in this specification with those defined in the XML schemas.

\begin{table}[th]
\begin{tabular}{p{0.38\textwidth}p{0.27\textwidth}p{0.34\textwidth}}
\sptablerule
\multirow{2}{*}{\textbf{Cone Search Metadatum}}&\multicolumn{2}{p{0.59\textwidth}}{\textbf{VOResource Metadatum}}\\
&\textbf{Schema Name}&\textbf{XPath Name}\\
\sptablerule
\textbf{ResponsibleParty} & VOResource & curation/publisher, curation/contact/email\\
\textbf{ServiceName} & VOResource & title\\
\textbf{Description} &	VOResource & content/description\\
\textbf{Instrument} & VOResource & instrument\\
\textbf{Waveband} & VODataService & coverage/spectral/waveband\\
\textbf{Epoch} & VODataService & coverage/temporal/startTime, coverage/temporal/stopTime\textsuperscript{1}\\
\textbf{Coverage} & VODataService & coverage/spatial\textsuperscript{2}\\
\textbf{MaxSR} & ConeSearch & capability/maxSR\\
\textbf{MaxRecords} & ConeSearch & capability/maxRecords\\
\textbf{Verbosity} & ConeSearch & capability/verbosity\\
\textbf{BaseURL} & VOResource & interface/accessURL\\
\sptablerule
\caption{VOResource pre-0.10 extension}
\label{table:extable}
\end{tabular}
\end{table}
Table Notes:
\begin{enumerate}
 \item The notion of the epoch the observations is captured in the schema inside coverage/temporal. The notion of the equinox of the observational positions is captured within coverage/spatial/region, such as in coverage/spatial/region[@xsi:type='vs:Circle']/coordFrame. 
 \item the coverage/spatial element encodes its information as a complex set of child elements.
\end{enumerate}

\subsection{VOResource (v1.0) Schema Extension for Cone Search Services}
With the expected adoption of the IVOA standard for Registry Interface, resources are described using the VOResource schema, v1.0 and its family of extensions. Cone Search services are specifically described using the VODataService, v1.0, and ConeSearch, v1.0, extension schemas. Coverage information is encoded using the Space-Time Coordinates (STC) schema.

The following table enumerates the mapping of resource profile metadata defined in this specification with those defined in the XML schemas.

\begin{table}[th]
\begin{tabular}{p{0.4\textwidth}p{0.29\textwidth}p{0.3\textwidth}}
\sptablerule
\multirow{2}{*}{\textbf{Cone Search Metadatum}}&\multicolumn{2}{p{0.59\textwidth}}{\textbf{VOResource Metadatum}}\\
&\textbf{Schema Name}&\textbf{XPath Name}\\
\sptablerule
\textbf{ResponsibleParty} & VOResource & curation/publisher, curation/contact/email\\
\textbf{ServiceName} & VOResource & title\\
\textbf{Description} &	VOResource & content/description\\
\textbf{Instrument} & VOResource & instrument\\
\textbf{Waveband} & VODataService & coverage/waveband\\
\textbf{Epoch} & VODataService & coverage/stc:STCResourceProfile/stc:AstroCoordArea\textsuperscript{1}\\
\textbf{Coverage} & VODataService & coverage/stc:STCResourceProfile/stc:AstroCoordArea\textsuperscript{1}\\
\textbf{MaxSR} & ConeSearch & capability/maxSR\\
\textbf{MaxRecords} & ConeSearch & capability/maxRecords\\
\textbf{Verbosity} & ConeSearch & capability/verbosity\\
\textbf{BaseURL} & VOResource & capability/interface[@role='std']/accessURL\\
\sptablerule
\caption{VOResource 1.0 extension}
\label{table:extable}
\end{tabular}
\end{table}

Table Notes:
\begin{enumerate}
	\item In STC, coverage on the sky and in time are described in an integrated way within the stc:AstroCoordArea element. The notion of the equinox of the observational positions is captured within stc:AstroCoordSystem element.
\end{enumerate}
Subsequent versions of this document should include the ConeSearch extension schema as a formal part of the specification.

\section{Changes from Previous Versions}
\label{app:changes}

\subsection{Changes from REC-1.03}
\begin{itemize}
	\item removed fixed version (1.0 or 1.1) for VOTable default response
	\item Added DALI MAXREC and RESPONSEFORMAT
	\item Added POST as optional HTTP query method
	\item Addition of authors/editors.
	\item Plain porting of the HTML document into ivoatex template, including change history, then modified it and reshaped.
\end{itemize}

\subsection{Changes from PR-1.02}
\begin{itemize}
	\item converted to Recommendation
\end{itemize}

\subsection{Changes from PR-1.01}
\begin{itemize}
	\item eliminated the choice of encoding an ERROR response in a PARAM that is a direct child of VOTABLE as this is not legal in the VOTable schema.
	\item Allowed the use of the INFO element for error messages.
	\item In examples, made sure PARAM elements have datatype attributes
	\item Corrected wording to be definitive that positions are given in the ICRS coordinate system.
	\item Other typos.
\end{itemize}

\subsection{Changes from PR-1.00}
\begin{itemize}
	\item Various typos.
	\item Clarified description of VERB parameter:
	\begin{itemize}
		\item Clarified what is meant by optional for client and server.
		\item Clarified the meaning of the values.
	\end{itemize}
	\item Explicitly mention the 3 legal locations for ERROR messages.
	\item Refer to string types as character arrays, as per the VOTable std.
	\item Prefers text/xml;content=x-votable over text/xml;votable.
	\item Added examples of error message, legal response in appendix.
\end{itemize}

\subsection{Changes from the original NVO Specification Document}
\begin{itemize}
	\item References to the original HTML document have been replaced with references to this IVOA specification.
	\item Replaced references to "curator" with "data provider" or similar wording.
	\item Replaced references to the NVO with references either to the IVOA or this specification, as appropriate.
	\item Ambiguous language like "perhaps" has been replaced with more definitive wording where appropriate. Use of the word "will" is replaced with "must" and "can" with "may", in accordance with the definitions set in the preface.
	\item Grammatical and spelling corrections have been made.
	\item The content is organized into sections typical of an IVOA spec.
	\item Description of the URL syntax is sharper, borrowing language from the SIA specification [SIA]. This includes:
	\begin{itemize}
		\item More explicitly specifying the form of the URL.
		\item Sharpening the definition of the input parameters.
		\item Indicating that parameter order is not significant.
		\item Stating explicitly that unsupported optional arguments should be ignored.
		\item Adding examples.
		\item Re-ordering information for improved flow.
	\end{itemize}
	\item The version of VOTable supported is explicitly stated.
	\item Whereas the NVO version describes the parameter with ucd="OBS\_ANG-SIZE" as "an expression of the opening angle of the cones", this version describes it specifically as "an expression of the uncertainty of the positions".
	\item A note has been added to recognize the ambiguity in the location of the ERROR parameter.
	\item The general description of the resource profile has been altered to allow rendering of the metadata to change according to the standards and conventions of the IVOA.
	\item An editor's note has been added that makes reference to the RM document [RM].
	\item A requirement that \textbf{MaxSR} be given in decimal degrees has been added.
	\item For the \textbf{BaseURL} resource profile metadatum, the example has been replaced with a reference to the BaseURL syntax description.
	\item An appendix has been added to describe the current practice for registering Cone Search services.
\end{itemize}

\bibliography{ivoatex/ivoabib,ivoatex/docrepo,scs}


\end{document}
